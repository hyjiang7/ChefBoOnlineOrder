{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/helenjiang/Desktop/ChefBoOnline/ChefBoOnlineOrder/chefbo/pages/routes/checkout.js\";\nimport React, { useState, useContext, useEffect } from \"react\";\nimport moment from \"moment\";\nimport momentz from \"moment-timezone\"; //needed\n\nimport store from \"../../state/GlobalState\";\nimport { useRouter } from \"next/router\";\nimport { addCustomerInfo, setTips } from \"../../state/Actions\";\nconst FULL12FORMAT = \"dddd MM-DD-YY HH:mm\";\nconst DATEFORMAT = \"dddd MM-DD-YY\";\nconst TIMEZONE = \"America/Los_Angeles\";\n\nconst checkout = () => {\n  // const closedDays = [\"11/25/2021\", \"12/25/2021\", \"07/04/2022\"]\n  const lunch = store.getState().lunchInCart > 0;\n  const router = useRouter();\n  console.log(store.getState().Cart.length);\n  const lunchSpecialHours = [[], [\"11:00\", \"15:00\"], [\"11:00\", \"15:00\"], [\"11:00\", \"15:00\"], [\"11:00\", \"15:00\"], [\"11:00\", \"15:00\"], [\"12:00\", \"15:00\"]];\n  var hoursOfOperation = [[], //change!!!\n  [\"11:00\", \"15:00\", \"16:30\", \"21:00\"], [\"11:00\", \"15:00\", \"16:30\", \"21:00\"], [\"11:00\", \"15:00\", \"16:30\", \"21:00\"], [\"11:00\", \"15:00\", \"16:30\", \"21:00\"], [\"11:00\", \"15:00\", \"16:30\", \"21:30\"], [\"12:00\", \"15:00\", \"16:30\", \"21:30\"]];\n  if (lunch > 0) hoursOfOperation = lunchSpecialHours;\n  var today = moment(moment()).tz(TIMEZONE);\n  var day = today.day(); //number\n\n  var date = today.format(DATEFORMAT); //string\n\n  var todayClose2 = moment.tz(`${date} ${hoursOfOperation[day][hoursOfOperation[day].length - 1]}`, FULL12FORMAT, TIMEZONE);\n  var open = today.isBefore(todayClose2);\n  var validTimesOne = [];\n  var validDays = [];\n  var validTimesTwo = [];\n  var dateOne;\n  var dateTwo;\n  var dateTwoDay;\n  var dayOneOpen1, dayOneClose1, dayOneOpen2, dayOneClose2;\n  var dayTwoOpen1, dayTwoClose1, dayTwoOpen2, dayTwoClose2; //today is open!\n\n  if (open) {\n    validDays.push(`Today (${date})`);\n    dateOne = date;\n    dayOneOpen1 = moment.tz(`${dateOne} ${hoursOfOperation[day][0]}`, FULL12FORMAT, TIMEZONE);\n    dayOneClose1 = moment.tz(`${dateOne} ${hoursOfOperation[day][1]}`, FULL12FORMAT, TIMEZONE);\n    dayOneOpen2 = moment.tz(`${dateOne} ${hoursOfOperation[day][2]}`, FULL12FORMAT, TIMEZONE);\n    dayOneClose2 = moment.tz(`${dateOne} ${hoursOfOperation[day][3]}`, FULL12FORMAT, TIMEZONE);\n    day == 6 ? dateTwo = today.add(2, \"days\") : dateTwo = today.add(1, \"days\");\n    dateTwoDay = dateTwo.day();\n    dateTwo = dateTwo.format(DATEFORMAT);\n    validDays.push(dateTwo);\n    dayTwoOpen1 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][0]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoClose1 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][1]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoOpen2 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][2]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoClose2 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][3]}`, FULL12FORMAT, TIMEZONE);\n    today = moment(moment()).tz(TIMEZONE); //reset today\n\n    if (today.isBefore(dayOneOpen1)) {\n      //store not opened yet\n      validTimesOne = availablePickUpTimes(dayOneOpen1, dayOneClose1);\n    } else {\n      validTimesOne.push(\"ASAP\");\n      validTimesOne = validTimesOne.concat(availablePickUpTimes(today, dayOneClose1));\n    }\n\n    validTimesOne = validTimesOne.concat(availablePickUpTimes(dayOneOpen2, dayOneClose2));\n    validTimesTwo = availablePickUpTimes(dayTwoOpen1, dayTwoClose1);\n    validTimesTwo = validTimesTwo.concat(availablePickUpTimes(dayTwoOpen2, dayTwoClose2));\n  } else {\n    day == 6 ? dateOne = today.add(2, \"days\") : dateOne = today.add(1, \"days\");\n    day = dateOne.day();\n    dateOne = dateOne.format(DATEFORMAT);\n    validDays.push(dateOne);\n    dayOneOpen1 = moment.tz(`${dateOne} ${hoursOfOperation[day][0]}`, FULL12FORMAT, TIMEZONE);\n    dayOneClose1 = moment.tz(`${dateOne} ${hoursOfOperation[day][1]}`, FULL12FORMAT, TIMEZONE);\n    dayOneOpen2 = moment.tz(`${dateOne} ${hoursOfOperation[day][2]}`, FULL12FORMAT, TIMEZONE);\n    dayOneClose2 = moment.tz(`${dateOne} ${hoursOfOperation[day][3]}`, FULL12FORMAT, TIMEZONE);\n    dateTwo = today.add(1, \"days\");\n    dateTwoDay = dateTwo.day();\n    dateTwo = dateTwo.format(DATEFORMAT);\n    validDays.push(dateTwo);\n    dayTwoOpen1 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][0]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoClose1 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][1]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoOpen2 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][2]}`, FULL12FORMAT, TIMEZONE);\n    dayTwoClose2 = moment.tz(`${dateTwo} ${hoursOfOperation[dateTwoDay][3]}`, FULL12FORMAT, TIMEZONE);\n    validTimesOne.push(\"ASAP\");\n    validTimesOne = validTimesOne.concat(availablePickUpTimes(dayOneOpen1, dayOneClose1));\n    validTimesOne = validTimesOne.concat(availablePickUpTimes(dayOneOpen2, dayOneClose2));\n    validTimesTwo = availablePickUpTimes(dayTwoOpen1, dayTwoClose1);\n    validTimesTwo = validTimesTwo.concat(availablePickUpTimes(dayTwoOpen2, dayTwoClose2));\n  }\n\n  function availablePickUpTimes(startTime, endTime) {\n    var timeArr = [];\n    const mins = 15 - startTime.minute() % 15;\n    var firstTime = startTime.add(mins, \"m\");\n    mins == 15 ? null : firstTime.add(15, \"m\");\n\n    while (firstTime.isBefore(endTime)) {\n      timeArr.push(new moment(firstTime).format(\"h:mm a\"));\n      firstTime.add(15, \"m\");\n    }\n\n    return timeArr;\n  }\n\n  const tipsPercent = [0, 12, 15, 18, 20, 22];\n\n  function calcTips() {\n    const {\n      subtotal\n    } = store.getState();\n    var tips = [];\n    tipsPercent.forEach(i => {\n      tips.push((subtotal * (i / 100)).toFixed(2));\n    });\n    console.log(tips);\n    return tips;\n  }\n\n  const {\n    0: dateChange,\n    1: setDateChange\n  } = useState(0);\n  const {\n    0: times,\n    1: setTimes\n  } = useState(validTimesOne);\n  const {\n    0: timeChange,\n    1: setTime\n  } = useState(validTimesOne[0]);\n  const {\n    0: tipsSelection,\n    1: SetTipsSelection\n  } = useState([\"\"]);\n  const {\n    0: fnameError,\n    1: setFnameError\n  } = useState(\"\");\n  const {\n    0: lnameError,\n    1: setLnameError\n  } = useState(\"\");\n  const {\n    0: emailError,\n    1: setEmailError\n  } = useState(\"\");\n  const {\n    0: phoneError,\n    1: setPhoneError\n  } = useState(\"\");\n  const {\n    0: tipsError,\n    1: setTipsError\n  } = useState(\"\"); //   useEffect(() =>{\n  //     if(store.getState().Cart.length < 1){\n  //         router.replace(\"/routes/pickup\")\n  //     }\n  //   }, [])\n\n  useEffect(() => {\n    SetTipsSelection(calcTips());\n    dateChange == 0 ? setTimes(validTimesOne) : setTimes(validTimesTwo);\n  }, [dateChange]);\n\n  function handleDateChange(e) {\n    setDateChange(e.target.value);\n  }\n\n  function handleTimeChange(e) {\n    setTime(e.target.value);\n  }\n\n  async function reviewOrder(e) {\n    //check if payment is valid\n    e.preventDefault();\n    var tips = e.target.form.elements.tips.value;\n    var fname = e.target.form.elements.fname.value;\n    var lname = e.target.form.elements.lname.value;\n    var email = e.target.form.elements.email.value;\n    var phone = e.target.form.elements.phone.value;\n    console.log(e.target.form);\n\n    if (!fname || !lname || !email || !phone || !tips) {\n      if (!fname) {\n        setFnameError(\"Required!!\");\n      } else {\n        setFnameError(\"\");\n      }\n\n      if (!lname) {\n        setLnameError(\"Required!!\");\n      } else {\n        setLnameError(\"\");\n      }\n\n      if (!email) {\n        setEmailError(\"Required!!\");\n      } else {\n        setEmailError(\"\");\n      }\n\n      if (!phone) {\n        setPhoneError(\"Required!!\");\n      } else {\n        setPhoneError(\"\");\n      }\n\n      if (!tips) {\n        setTipsError(\"Required!!\");\n      } else {\n        setTipsError(\"\");\n      }\n    } else {\n      var req = await fetch(\"http://localhost:5001/validate-email\", {\n        method: \"POST\",\n        headers: {\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          email: email\n        })\n      });\n      const validEmail = await req.json();\n      console.log(validEmail);\n\n      if (!validEmail) {\n        setEmailError(\"Invalid Email\");\n        return;\n      } else {\n        setEmailError(\"\");\n      }\n\n      req = await fetch(\"http://localhost:5001/validate-phone\", {\n        method: \"POST\",\n        headers: {\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          phone: phone\n        })\n      });\n      const validPhone = await req.json();\n\n      if (!validPhone) {\n        setPhoneError(\"Invalid Phone\");\n        return;\n      } else {\n        setPhoneError(\"\");\n      }\n\n      setFnameError(\"\");\n      setLnameError(\"\");\n      setTipsError(\"\");\n      const customer = {\n        fname: fname,\n        lname: lname,\n        email: email,\n        phone: phone,\n        time: timeChange\n      };\n      dateChange == 0 ? customer.date = dateOne : customer.date = dateTwo;\n      store.dispatch(setTips(parseFloat(tips)));\n      store.dispatch(addCustomerInfo(customer));\n      router.push(\"/routes/submit\");\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"col-12 col-sm-8 col-lg-6 m-auto\",\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"form\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"\",\n          htmlFor: \"day\",\n          children: \"Select Pick Up Date\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"day\",\n          className: \"form-control\",\n          onChange: handleDateChange,\n          children: validDays.map((i, ind) => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: ind,\n            children: i\n          }, ind, false, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"\",\n          htmlFor: \"time\",\n          children: \"Select a Time\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"time\",\n          className: \"form-control\",\n          onChange: handleTimeChange,\n          children: times.map((i, ind) => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: `${i}`,\n            children: i\n          }, ind, false, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col mb-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"fname\",\n            children: [\" \", \"First Name* \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-danger\",\n              children: fnameError\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"fname\",\n            type: \"text\",\n            className: \"form-control\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"lname\",\n            children: [\" \", \"Last Name* \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-danger\",\n              children: lnameError\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 26\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 399,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"lname\",\n            type: \"text\",\n            className: \"form-control\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"email\",\n          children: [\" \", \"Email* \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-danger\",\n            children: emailError\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 20\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"email\",\n          id: \"email\",\n          type: \"email\",\n          pattern: \"^[a-zA-Z0-9.!#$%&\\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*$\",\n          className: \"form-control\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"phone\",\n          children: [\" \", \"Phone number (digits only)*\", \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-danger\",\n            children: phoneError\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"phone\",\n          name: \"phone\",\n          type: \"tel\",\n          pattern: \"[0-9]{3}[0-9]{3}[0-9]{4}\",\n          className: \"form-control\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Select Tip Amount \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-danger\",\n            children: tipsError\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input-group\",\n          children: tipsSelection.map((i, ind) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-check w-50\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-check-input\",\n              name: \"tips\",\n              id: i,\n              type: \"radio\",\n              value: i,\n              \"aria-label\": `Radio tips amount ${tipsPercent[ind]}%`,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: i,\n              children: `${i} (${tipsPercent[ind]}%)`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 454,\n              columnNumber: 17\n            }, this)]\n          }, ind, true, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group d-flex justify-content-center mt-3\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"submit\",\n          type: \"submit\",\n          onClick: reviewOrder,\n          className: \"btn btn-primary\",\n          value: \"Review and Submit Order\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 353,\n    columnNumber: 5\n  }, this);\n};\n\nexport default checkout;","map":{"version":3,"sources":["/Users/helenjiang/Desktop/ChefBoOnline/ChefBoOnlineOrder/chefbo/pages/routes/checkout.js"],"names":["React","useState","useContext","useEffect","moment","momentz","store","useRouter","addCustomerInfo","setTips","FULL12FORMAT","DATEFORMAT","TIMEZONE","checkout","lunch","getState","lunchInCart","router","console","log","Cart","length","lunchSpecialHours","hoursOfOperation","today","tz","day","date","format","todayClose2","open","isBefore","validTimesOne","validDays","validTimesTwo","dateOne","dateTwo","dateTwoDay","dayOneOpen1","dayOneClose1","dayOneOpen2","dayOneClose2","dayTwoOpen1","dayTwoClose1","dayTwoOpen2","dayTwoClose2","push","add","availablePickUpTimes","concat","startTime","endTime","timeArr","mins","minute","firstTime","tipsPercent","calcTips","subtotal","tips","forEach","i","toFixed","dateChange","setDateChange","times","setTimes","timeChange","setTime","tipsSelection","SetTipsSelection","fnameError","setFnameError","lnameError","setLnameError","emailError","setEmailError","phoneError","setPhoneError","tipsError","setTipsError","handleDateChange","e","target","value","handleTimeChange","reviewOrder","preventDefault","form","elements","fname","lname","email","phone","req","fetch","method","headers","Accept","body","JSON","stringify","validEmail","json","validPhone","customer","time","dispatch","parseFloat","map","ind"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from \"react\";\nimport moment from \"moment\";\nimport momentz from \"moment-timezone\"; //needed\nimport store from \"../../state/GlobalState\";\nimport { useRouter } from \"next/router\";\n\nimport { addCustomerInfo, setTips } from \"../../state/Actions\";\n\nconst FULL12FORMAT = \"dddd MM-DD-YY HH:mm\";\nconst DATEFORMAT = \"dddd MM-DD-YY\";\nconst TIMEZONE = \"America/Los_Angeles\";\n\nconst checkout = () => {\n  // const closedDays = [\"11/25/2021\", \"12/25/2021\", \"07/04/2022\"]\n  const lunch = store.getState().lunchInCart > 0;\n  const router = useRouter();\n\n  console.log(store.getState().Cart.length)\n  \n\n  const lunchSpecialHours = [\n    [],\n    [\"11:00\", \"15:00\"],\n    [\"11:00\", \"15:00\"],\n    [\"11:00\", \"15:00\"],\n    [\"11:00\", \"15:00\"],\n    [\"11:00\", \"15:00\"],\n    [\"12:00\", \"15:00\"],\n  ];\n\n  var hoursOfOperation = [\n    [], //change!!!\n    [\"11:00\", \"15:00\", \"16:30\", \"21:00\"],\n    [\"11:00\", \"15:00\", \"16:30\", \"21:00\"],\n    [\"11:00\", \"15:00\", \"16:30\", \"21:00\"],\n    [\"11:00\", \"15:00\", \"16:30\", \"21:00\"],\n    [\"11:00\", \"15:00\", \"16:30\", \"21:30\"],\n    [\"12:00\", \"15:00\", \"16:30\", \"21:30\"],\n  ];\n\n  if (lunch > 0) hoursOfOperation = lunchSpecialHours;\n\n  var today = moment(moment()).tz(TIMEZONE);\n  var day = today.day(); //number\n  var date = today.format(DATEFORMAT); //string\n  var todayClose2 = moment.tz(\n    `${date} ${hoursOfOperation[day][hoursOfOperation[day].length - 1]}`,\n    FULL12FORMAT,\n    TIMEZONE\n  );\n  var open = today.isBefore(todayClose2);\n  var validTimesOne = [];\n  var validDays = [];\n  var validTimesTwo = [];\n  var dateOne;\n  var dateTwo;\n  var dateTwoDay;\n  var dayOneOpen1, dayOneClose1, dayOneOpen2, dayOneClose2;\n  var dayTwoOpen1, dayTwoClose1, dayTwoOpen2, dayTwoClose2;\n\n  //today is open!\n  if (open) {\n    validDays.push(`Today (${date})`);\n    dateOne = date;\n    dayOneOpen1 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][0]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneClose1 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][1]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneOpen2 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][2]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneClose2 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][3]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n\n    day == 6\n      ? (dateTwo = today.add(2, \"days\"))\n      : (dateTwo = today.add(1, \"days\"));\n    dateTwoDay = dateTwo.day();\n    dateTwo = dateTwo.format(DATEFORMAT);\n    validDays.push(dateTwo);\n\n    dayTwoOpen1 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][0]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoClose1 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][1]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoOpen2 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][2]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoClose2 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][3]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n\n    today = moment(moment()).tz(TIMEZONE); //reset today\n    if (today.isBefore(dayOneOpen1)) {\n      \n        //store not opened yet\n      validTimesOne = availablePickUpTimes(dayOneOpen1, dayOneClose1);\n    } else {\n        validTimesOne.push(\"ASAP\")\n      validTimesOne = validTimesOne.concat(availablePickUpTimes(today, dayOneClose1));\n    }\n    validTimesOne = validTimesOne.concat(\n      availablePickUpTimes(dayOneOpen2, dayOneClose2)\n    );\n\n    validTimesTwo = availablePickUpTimes(dayTwoOpen1, dayTwoClose1);\n\n    validTimesTwo = validTimesTwo.concat(\n      availablePickUpTimes(dayTwoOpen2, dayTwoClose2)\n    );\n  } else {\n    day == 6\n      ? (dateOne = today.add(2, \"days\"))\n      : (dateOne = today.add(1, \"days\"));\n    day = dateOne.day();\n    dateOne = dateOne.format(DATEFORMAT);\n    validDays.push(dateOne);\n    dayOneOpen1 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][0]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneClose1 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][1]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneOpen2 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][2]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayOneClose2 = moment.tz(\n      `${dateOne} ${hoursOfOperation[day][3]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n\n    dateTwo = today.add(1, \"days\");\n    dateTwoDay = dateTwo.day();\n    dateTwo = dateTwo.format(DATEFORMAT);\n    validDays.push(dateTwo);\n    dayTwoOpen1 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][0]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoClose1 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][1]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoOpen2 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][2]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n    dayTwoClose2 = moment.tz(\n      `${dateTwo} ${hoursOfOperation[dateTwoDay][3]}`,\n      FULL12FORMAT,\n      TIMEZONE\n    );\n\n    validTimesOne.push(\"ASAP\")\n    validTimesOne = validTimesOne.concat(availablePickUpTimes(dayOneOpen1, dayOneClose1));\n    validTimesOne = validTimesOne.concat(\n      availablePickUpTimes(dayOneOpen2, dayOneClose2)\n    );\n    validTimesTwo = availablePickUpTimes(dayTwoOpen1, dayTwoClose1);\n    validTimesTwo = validTimesTwo.concat(\n      availablePickUpTimes(dayTwoOpen2, dayTwoClose2)\n    );\n\n  }\n\n  function availablePickUpTimes(startTime, endTime) {\n    var timeArr = [];\n\n    const mins = 15 - (startTime.minute() % 15);\n    var firstTime = startTime.add(mins, \"m\");\n    mins == 15 ? null : firstTime.add(15, \"m\");\n\n    while (firstTime.isBefore(endTime)) {\n      timeArr.push(new moment(firstTime).format(\"h:mm a\"));\n      firstTime.add(15, \"m\");\n    }\n    return timeArr;\n  }\n\n  const tipsPercent = [0, 12, 15, 18, 20, 22];\n\n  function calcTips() {\n    const { subtotal } = store.getState();\n\n    var tips = [];\n    tipsPercent.forEach((i) => {\n      tips.push((subtotal * (i / 100)).toFixed(2));\n    });\n\n    console.log(tips);\n    return tips;\n  }\n\n  const [dateChange, setDateChange] = useState(0);\n  const [times, setTimes] = useState(validTimesOne);\n  const [timeChange, setTime] = useState(validTimesOne[0]);\n  const [tipsSelection, SetTipsSelection] = useState([\"\"]);\n  const [fnameError, setFnameError] = useState(\"\");\n  const [lnameError, setLnameError] = useState(\"\");\n  const [emailError, setEmailError] = useState(\"\");\n  const [phoneError, setPhoneError] = useState(\"\");\n  const [tipsError, setTipsError] = useState(\"\");\n\n//   useEffect(() =>{\n//     if(store.getState().Cart.length < 1){\n//         router.replace(\"/routes/pickup\")\n//     }\n//   }, [])\n\n  useEffect(() => {\n    SetTipsSelection(calcTips());\n\n    dateChange == 0 ? setTimes(validTimesOne) : setTimes(validTimesTwo);\n  }, [dateChange]);\n\n  function handleDateChange(e) {\n    setDateChange(e.target.value);\n  }\n\n  function handleTimeChange(e) {\n    setTime(e.target.value);\n  }\n\n  async function reviewOrder(e) {\n    //check if payment is valid\n\n    e.preventDefault();\n\n    var tips = e.target.form.elements.tips.value;\n    var fname = e.target.form.elements.fname.value;\n    var lname = e.target.form.elements.lname.value;\n    var email = e.target.form.elements.email.value;\n    var phone = e.target.form.elements.phone.value;\n    console.log(e.target.form);\n\n    if (!fname || !lname || !email || !phone || !tips) {\n      if (!fname) {\n        setFnameError(\"Required!!\");\n      } else {\n        setFnameError(\"\");\n      }\n      if (!lname) {\n        setLnameError(\"Required!!\");\n      } else {\n        setLnameError(\"\");\n      }\n      if (!email) {\n        setEmailError(\"Required!!\");\n      } else {\n        setEmailError(\"\");\n      }\n      if (!phone) {\n        setPhoneError(\"Required!!\");\n      } else {\n        setPhoneError(\"\");\n      }\n      if (!tips) {\n        setTipsError(\"Required!!\");\n      } else {\n        setTipsError(\"\");\n      }\n    } else {\n      var req = await fetch(\"http://localhost:5001/validate-email\", {\n        method: \"POST\",\n        headers: {\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ email: email }),\n      });\n      const validEmail = await req.json();\n      console.log(validEmail);\n      if (!validEmail) {\n        setEmailError(\"Invalid Email\");\n        return;\n      }\n      else{\n          setEmailError(\"\")\n      }\n\n      req = await fetch(\"http://localhost:5001/validate-phone\", {\n        method: \"POST\",\n        headers: {\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ phone: phone }),\n      });\n      const validPhone = await req.json();\n      if (!validPhone) {\n        setPhoneError(\"Invalid Phone\");\n        return;\n      }\n      else{\n          setPhoneError(\"\")\n      }\n\n      setFnameError(\"\");\n      setLnameError(\"\");\n      setTipsError(\"\");\n\n      const customer = {\n        fname: fname,\n        lname: lname,\n        email: email,\n        phone: phone,\n        time: timeChange,\n      };\n\n      dateChange == 0 ? (customer.date = dateOne) : (customer.date = dateTwo);\n\n      store.dispatch(setTips(parseFloat(tips)));\n\n      store.dispatch(addCustomerInfo(customer));\n      router.push(\"/routes/submit\");\n    }\n  }\n\n  \n\n  return (\n    <div className=\"col-12 col-sm-8 col-lg-6 m-auto\">\n      <form className=\"form\">\n        <div className=\"form-group\">\n          <label className=\"\" htmlFor=\"day\">\n            Select Pick Up Date\n          </label>\n          <select\n            name=\"day\"\n            className=\"form-control\"\n            onChange={handleDateChange}\n          >\n            {validDays.map((i, ind) => (\n              <option key={ind} value={ind}>\n                {i}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div className=\"form-group\">\n          <label className=\"\" htmlFor=\"time\">\n            Select a Time\n          </label>\n          <select\n            name=\"time\"\n            className=\"form-control\"\n            onChange={handleTimeChange}\n          >\n            {times.map((i, ind) => (\n              <option key={ind} value={`${i}`}>\n                {i}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div className=\"row\">\n          <div className=\"col mb-2\">\n            <label htmlFor=\"fname\">\n              {\" \"}\n              First Name* <span className=\"text-danger\">{fnameError}</span>\n            </label>\n            <input name=\"fname\" type=\"text\" className=\"form-control\" required />\n          </div>\n\n          <div className=\"col\">\n            <label htmlFor=\"lname\">\n              {\" \"}\n              Last Name* <span className=\"text-danger\">{lnameError}</span>\n            </label>\n            <input name=\"lname\" type=\"text\" className=\"form-control\" required />\n          </div>\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"email\">\n            {\" \"}\n            Email* <span className=\"text-danger\">{emailError}</span>\n          </label>\n          <input\n            name=\"email\"\n            id=\"email\"\n            type=\"email\"\n            pattern=\"^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$\"\n            className=\"form-control\"\n            required\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"phone\">\n            {\" \"}\n            Phone number (digits only)*{\" \"}\n            <span className=\"text-danger\">{phoneError}</span>\n          </label>\n          <input\n            id=\"phone\"\n            name=\"phone\"\n            type=\"tel\"\n            pattern=\"[0-9]{3}[0-9]{3}[0-9]{4}\"\n            className=\"form-control\"\n            required\n          />\n        </div>\n\n        <div className=\"\">\n          <p>\n            Select Tip Amount <span className=\"text-danger\">{tipsError}</span>\n          </p>\n          <div className=\"input-group\">\n            {tipsSelection.map((i, ind) => (\n              <div className=\"form-check w-50\" key={ind}>\n                <input\n                  className=\"form-check-input\"\n                  name=\"tips\"\n                  id={i}\n                  type=\"radio\"\n                  value={i}\n                  aria-label={`Radio tips amount ${tipsPercent[ind]}%`}\n                  required\n                />\n                <label htmlFor={i}>{`${i} (${tipsPercent[ind]}%)`}</label>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"form-group d-flex justify-content-center mt-3\">\n          <input\n            id=\"submit\"\n            type=\"submit\"\n            onClick={reviewOrder}\n            className=\"btn btn-primary\"\n            value=\"Review and Submit Order\"\n          />\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default checkout;\n"]},"metadata":{},"sourceType":"module"}